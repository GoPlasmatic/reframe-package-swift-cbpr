{
    "id": "mt192-error-handler",
    "name": "MT192 Error Handler",
    "description": "Handles precondition errors and stops translation when necessary",
    "priority": 5,
    "condition": { "and": [
        {"==": [{"var": "metadata.direction"}, "outgoing"]},
        {"==": [{"var": "metadata.SwiftMT.message_type"}, "192"]},
        {"==": [{"var": "metadata.SwiftMT.method"}, "normal"]},
        {"==": [{"var": "metadata.progress.workflow_id"}, "mt192-precondition"]},
        {"==": [{"var": "metadata.progress.task_id"}, "check_precondition_errors"]},
        {"==": [{"var": "metadata.progress.status_code"}, 200]},
        {"var": "temp_data.has_errors"}
    ]},
    "tasks": [
        {
            "id": "raise_translation_error",
            "name": "Raise Translation Error",
            "description": "Stop translation and report the error",
            "function": {
                "name": "map",
                "input": {
                    "mappings": [
                        {
                            "path": "data.translation_error",
                            "logic": {
                                "error_code": { "if": [
                                    {"var": "temp_data.prec001_error"},
                                    "T20087",
                                    { "if": [
                                        {"var": "temp_data.prec002_error"},
                                        "T20088",
                                        { "if": [
                                            {"var": "temp_data.prec004_error"},
                                            "T20278",
                                            "UNKNOWN"
                                        ]}
                                    ]}
                                ]},
                                "error_message": {"var": "temp_data.error_message"},
                                "translation_stopped": true
                            }
                        },
                        {"path": "data.result", "logic": null}
                    ]
                }
            }
        }
    ]
}
