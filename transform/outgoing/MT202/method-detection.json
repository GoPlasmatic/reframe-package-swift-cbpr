{
    "id": "mt202-method-detector",
    "name": "MT202 Method Detection",
    "description": "Detects MT202 message variants (normal, reject, return, cover) by checking Field 72 and validation flag",
    "priority": 2,
    "condition": { "and": [
        {"==": [{"var": "metadata.SwiftMT.message_type"}, "202"]},
        {"==": [{"var": "metadata.progress.workflow_id"}, "parser"]},
        {"==": [{"var": "metadata.progress.task_id"}, "parse_mt_message"]},
        {"==": [{"var": "metadata.progress.status_code"}, 200]}
    ]},
    "tasks": [
        {
            "id": "detect_mt202_method",
            "name": "Detect MT202 Method",
            "description": "Check Field 72 for /REJT/ or /RETN/ patterns and validation flag for COV",
            "function": {
                "name": "map",
                "input": {
                    "mappings": [
                        {
                            "path": "metadata.SwiftMT.method",
                            "logic": { "if": [
                                {"starts_with": [{"var": "data.SwiftMT.fields.72.information.0"}, "/REJT/"]},
                                "reject",
                                { "if": [
                                    {"starts_with": [{"var": "data.SwiftMT.fields.72.information.0"}, "/RETN/"]},
                                    "return",
                                    { "if": [
                                        {"==": [{"var": "data.SwiftMT.user_header.validation_flag"}, "COV"]},
                                        "cover",
                                        "normal"
                                    ]}
                                ]}
                            ]}
                        }
                    ]
                }
            }
        }
    ]
}
