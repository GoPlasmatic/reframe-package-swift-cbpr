{
    "id": "mt103-method-detector",
    "name": "MT103 Method Detection",
    "description": "Detects MT103 message variants (normal/STP, reject, return) by checking Field 72 and Field 77B",
    "priority": 2,
    "condition": { "and": [
        {"==": [{"var": "metadata.SwiftMT.message_type"}, "103"]},
        {"==": [{"var": "metadata.progress.workflow_id"}, "parser"]},
        {"==": [{"var": "metadata.progress.task_id"}, "parse_mt_message"]},
        {"==": [{"var": "metadata.progress.status_code"}, 200]}
    ]},
    "tasks": [
        {
            "id": "detect_mt103_method",
            "name": "Detect MT103 Method",
            "description": "Check Field 72 for /REJT/ or /RETN/ patterns and Field 77B for return indicators",
            "function": {
                "name": "map",
                "input": {
                    "mappings": [
                        {
                            "path": "metadata.SwiftMT.method",
                            "logic": { "if": [
                                {"starts_with": [{"var": "data.SwiftMT.fields.72.information.0"}, "/REJT/"]},
                                "reject",
                                { "if": [
                                    { "or": [
                                        {"starts_with": [{"var": "data.SwiftMT.fields.72.information.0"}, "/RETN/"]},
                                        {"starts_with": [{"var": "data.SwiftMT.fields.77B.narrative.0"}, "/RETRES/"]}
                                    ]},
                                    "return",
                                    "stp"
                                ]}
                            ]}
                        }
                    ]
                }
            }
        }
    ]
}
