{
    "id": "combine-header-document-xml",
    "name": "Combine Header and Document XML",
    "description": "Combines header and documents XML using direct publishing of MX structures",
    "priority": 10,
    "condition": { "and": [
        {"==": [{"var": "metadata.progress.status_code"}, 200]},
        {"var": "data.header_xml"},
        {"var": "data.document_xml"}
    ]},
    "tasks": [
        {
            "id": "combine_xml_strings",
            "name": "Combine Header and Document XML Strings",
            "function": {
                "name": "map",
                "input": {
                    "mappings": [
                        {
                            "path": "data.result",
                            "logic": { "if": [
                                { "and": [
                                    {"var": "data.header_xml"},
                                    {"var": "data.document_xml"}
                                ]},
                                {
                                    "cat": [
                                        "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Envelope xmlns=\"urn:iso:std:iso:20022:tech:xsd:head.001.001.02\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">",
                                        {"var": "data.header_xml"},
                                        {"var": "data.document_xml"},
                                        "</Envelope>"
                                    ]
                                },
                                null
                            ]}
                        }
                    ]
                }
            }
        }
    ]
}
