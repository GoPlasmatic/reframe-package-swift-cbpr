{
    "id": "pain001-variant-detection",
    "name": "pain.001 Message Variant Detection",
    "description": "Detects pain.001 messages for MT101 transformation",
    "priority": 2,
    "condition": { "and": [
        {"==": [{"var": "metadata.ISO20022_MX.message_type"}, "pain.001"]},
        {"==": [{"var": "metadata.direction"}, "incoming"]}
    ]},
    "tasks": [
        {
            "id": "detect_pain001_variant",
            "name": "Detect pain.001 Variant",
            "description": "Detects pain.001 message variant and sets target MT type",
            "function": {
                "name": "map",
                "input": {
                    "mappings": [
                        {"path": "temp_data.detected_variant", "logic": "pain.001-to-MT101"},
                        {"path": "temp_data.target_mt_type", "logic": "MT101"},
                        {"path": "data.SwiftMT.message_type", "logic": "101"},
                        {
                            "path": "temp_data.variant_info",
                            "logic": {
                                "source_type": "pain.001",
                                "target_type": "MT101",
                                "description": "Customer Credit Transfer Initiation to Request for Transfer",
                                "cbpr_compliant": true
                            }
                        }
                    ]
                }
            }
        },
        {
            "id": "validate_pain001_structure",
            "name": "Validate pain.001 Structure",
            "description": "Validates basic pain.001 message structure",
            "function": {
                "name": "validate",
                "input": {
                    "rules": [
                        {
                            "path": "data.ISO20022_MX.Document.CstmrCdtTrfInitn.GrpHdr",
                            "logic": {"exists": ["data", "ISO20022_MX", "Document", "CstmrCdtTrfInitn", "GrpHdr"]},
                            "message": "pain.001 must have GroupHeader"
                        },
                        {
                            "path": "data.ISO20022_MX.Document.CstmrCdtTrfInitn.PmtInf",
                            "logic": {"exists": ["data", "ISO20022_MX", "Document", "CstmrCdtTrfInitn", "PmtInf"]},
                            "message": "pain.001 must have PaymentInformation"
                        },
                        {
                            "path": "data.ISO20022_MX.Document.CstmrCdtTrfInitn.PmtInf.CdtTrfTxInf",
                            "logic": {"exists": ["data", "ISO20022_MX", "Document", "CstmrCdtTrfInitn", "PmtInf", "CdtTrfTxInf"]},
                            "message": "pain.001 must have CreditTransferTransactionInformation"
                        }
                    ]
                }
            }
        }
    ]
}
