{
    "id": "camt108-to-mt111-mapping",
    "name": "camt.108 to MT111 Complete Mapping",
    "description": "Maps camt.108 to MT111 with proper message structure",
    "priority": 3,
    "condition": { "and": [
        {"==": [{"var": "metadata.ISO20022_MX.message_type"}, "camt.108"]},
        {"==": [{"var": "metadata.direction"}, "incoming"]},
        {"==": [{"var": "metadata.progress.workflow_id"}, "camt108-headers-mapping"]},
        {"==": [{"var": "metadata.progress.task_id"}, "map_headers"]},
        {"==": [{"var": "metadata.progress.status_code"}, 200]}
    ]},
    "tasks": [
        {
            "id": "map_mt111_structure",
            "name": "Map Complete MT111 Structure",
            "description": "Map all MT111 fields with proper structure",
            "function": {
                "name": "map",
                "input": {
                    "mappings": [
                        {
                            "path": "data.SwiftMT.fields.#20",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.GrpHdr.MsgId"},
                                {
                                    "reference": {
                                        "substr": [
                                            {"replace": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.GrpHdr.MsgId"}, "-", ""]},
                                            0,
                                            16
                                        ]
                                    }
                                },
                                {"reference": "NOTPROVIDED"}
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.#21",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqNb"},
                                {
                                    "reference": {
                                        "substr": [
                                            {"replace": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqNb"}, "-", ""]},
                                            0,
                                            16
                                        ]
                                    }
                                },
                                {"reference": "NOTPROVIDED"}
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.#30",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.IsseDt"},
                                {"execution_date": {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.IsseDt"}},
                                {"execution_date": "2000-01-01"}
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.32A",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.EffctvDt.Dt"},
                                {
                                    "value_date": {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.EffctvDt.Dt"},
                                    "currency": {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Amt.@Ccy"},
                                    "amount": {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Amt.$value"}
                                },
                                null
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.32B",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.EffctvDt.Dt"},
                                null,
                                {
                                    "currency": {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Amt.@Ccy"},
                                    "amount": {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Amt.$value"}
                                }
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.52A",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.DrwrAgt"},
                                { "if": [
                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.DrwrAgt.FinInstnId.BICFI"},
                                    {"bic": {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.DrwrAgt.FinInstnId.BICFI"}},
                                    null
                                ]},
                                null
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.52D",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.DrwrAgt"},
                                { "if": [
                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.DrwrAgt.FinInstnId.BICFI"},
                                    null,
                                    {
                                        "name_and_address": {
                                            "filter": [
                                                [
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.DrwrAgt.FinInstnId.Nm"},
                                                    { "if": [
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.DrwrAgt.PstlAdr.AdrLine.0"},
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.DrwrAgt.PstlAdr.AdrLine.0"},
                                                        null
                                                    ]}
                                                ],
                                                {"!!": {"var": ""}}
                                            ]
                                        }
                                    }
                                ]},
                                null
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.#59",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Pyee"},
                                {
                                    "name_and_address": {
                                        "filter": [
                                            [
                                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Pyee.Nm"},
                                                { "if": [
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Pyee.PstlAdr.StrtNm"},
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Pyee.PstlAdr.StrtNm"},
                                                    { "if": [
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Pyee.PstlAdr.AdrLine.0"},
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Pyee.PstlAdr.AdrLine.0"},
                                                        null
                                                    ]}
                                                ]},
                                                { "if": [
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Pyee.PstlAdr.TwnNm"},
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Pyee.PstlAdr.TwnNm"},
                                                    { "if": [
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Pyee.PstlAdr.AdrLine.1"},
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Pyee.PstlAdr.AdrLine.1"},
                                                        null
                                                    ]}
                                                ]},
                                                { "if": [
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Pyee.PstlAdr.Ctry"},
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Pyee.PstlAdr.Ctry"},
                                                    { "if": [
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Pyee.PstlAdr.AdrLine.2"},
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.Pyee.PstlAdr.AdrLine.2"},
                                                        null
                                                    ]}
                                                ]}
                                            ],
                                            {"!!": {"var": ""}}
                                        ]
                                    }
                                },
                                null
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.#75",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn"},
                                {
                                    "information": {
                                        "filter": [
                                            [
                                                { "if": [
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"},
                                                    { "if": [
                                                        {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}, "AC06"]},
                                                        "BLOCKED ACCOUNT",
                                                        { "if": [
                                                            {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}, "AC13"]},
                                                            "INVALID DEBTOR ACCOUNT TYPE",
                                                            { "if": [
                                                                {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}, "AGNT"]},
                                                                "INCORRECT AGENT",
                                                                { "if": [
                                                                    {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}, "AM04"]},
                                                                    "INSUFFICIENT FUNDS",
                                                                    { "if": [
                                                                        {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}, "BE05"]},
                                                                        "UNRECOGNISED INITIATING PARTY",
                                                                        { "if": [
                                                                            {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}, "CURR"]},
                                                                            "INCORRECT CURRENCY",
                                                                            { "if": [
                                                                                {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}, "CUST"]},
                                                                                "REQUESTED BY CUSTOMER",
                                                                                { "if": [
                                                                                    {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}, "DUPL"]},
                                                                                    "DUPLICATE PAYMENT",
                                                                                    { "if": [
                                                                                        {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}, "FRAU"]},
                                                                                        "FRAUDULENT ORIGINATED",
                                                                                        { "if": [
                                                                                            {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}, "LAWR"]},
                                                                                            "LEGAL REASONS",
                                                                                            { "if": [
                                                                                                {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}, "MD01"]},
                                                                                                "NO MANDATE",
                                                                                                { "if": [
                                                                                                    {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}, "NARR"]},
                                                                                                    "NARRATIVE",
                                                                                                    { "if": [
                                                                                                        {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}, "RC01"]},
                                                                                                        "BANK IDENTIFIER INCORRECT",
                                                                                                        { "if": [
                                                                                                            {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}, "TECH"]},
                                                                                                            "TECHNICAL PROBLEMS",
                                                                                                            {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Cd"}
                                                                                                        ]}
                                                                                                    ]}
                                                                                                ]}
                                                                                            ]}
                                                                                        ]}
                                                                                    ]}
                                                                                ]}
                                                                            ]}
                                                                        ]}
                                                                    ]}
                                                                ]}
                                                            ]}
                                                        ]}
                                                    ]},
                                                    { "if": [
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Prtry"},
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.Rsn.Prtry"},
                                                        null
                                                    ]}
                                                ]},
                                                { "if": [
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.AddtlInf"},
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopReq.Chq.ChqCxlOrStopRsn.AddtlInf"},
                                                    null
                                                ]}
                                            ],
                                            {"!!": {"var": ""}}
                                        ]
                                    }
                                },
                                null
                            ]}
                        }
                    ]
                }
            }
        }
    ]
}
