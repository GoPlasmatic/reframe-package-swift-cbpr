{
    "id": "camt057-sequence-mapping",
    "name": "camt.057 to MT210 Sequence Mapping",
    "description": "Maps notification items to MT210 repetitive sequence per CBPR+ specification",
    "priority": 6,
    "condition": { "and": [
        {"==": [{"var": "metadata.ISO20022_MX.message_type"}, "camt.057"]},
        {"==": [{"var": "metadata.direction"}, "incoming"]},
        {"==": [{"var": "metadata.progress.workflow_id"}, "camt057-mandatory-fields-mapping"]},
        {"==": [{"var": "metadata.progress.status_code"}, 200]}
    ]},
    "tasks": [
        {
            "id": "map_to_mt210_sequences",
            "name": "Map to MT210 Sequences",
            "description": "Convert items to MT210 sequence structure per TR004-TR007",
            "function": {
                "name": "map",
                "input": {
                    "mappings": [
                        {
                            "path": "data.SwiftMT.fields.##",
                            "logic": {
                                "map": [
                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Itm"},
                                    {
                                        "21": {
                                            "reference": { "if": [
                                                {"var": "EndToEndId"},
                                                {"var": "EndToEndId"},
                                                {"var": "Id"}
                                            ]}
                                        },
                                        "32B": {"currency": {"var": "Amt.@Ccy"}, "amount": {"var": "Amt.$value"}},
                                        "50": { "if": [
                                            { "and": [
                                                { "or": [
                                                    {"var": "Dbtr.Pty"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty"}
                                                ]},
                                                {
                                                    "not": { "or": [
                                                        {"var": "Dbtr.Pty.Id.OrgId.AnyBIC"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty.Id.OrgId.AnyBIC"}
                                                    ]}
                                                },
                                                {
                                                    "not": { "or": [
                                                        {"var": "Dbtr.Pty.PstlAdr.Ctry"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty.PstlAdr.Ctry"}
                                                    ]}
                                                }
                                            ]},
                                            {
                                                "name_and_address": [
                                                    { "if": [
                                                        {"var": "Dbtr.Pty.Nm"},
                                                        {"var": "Dbtr.Pty.Nm"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty.Nm"}
                                                    ]},
                                                    { "if": [
                                                        {"var": "Dbtr.Pty.PstlAdr.AdrLine.0"},
                                                        {"var": "Dbtr.Pty.PstlAdr.AdrLine.0"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty.PstlAdr.AdrLine.0"}
                                                    ]},
                                                    { "if": [
                                                        {"var": "Dbtr.Pty.PstlAdr.AdrLine.1"},
                                                        {"var": "Dbtr.Pty.PstlAdr.AdrLine.1"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty.PstlAdr.AdrLine.1"}
                                                    ]},
                                                    { "if": [
                                                        {"var": "Dbtr.Pty.PstlAdr.AdrLine.2"},
                                                        {"var": "Dbtr.Pty.PstlAdr.AdrLine.2"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty.PstlAdr.AdrLine.2"}
                                                    ]}
                                                ]
                                            },
                                            null
                                        ]},
                                        "50C": { "if": [
                                            { "and": [
                                                { "or": [
                                                    {"var": "Dbtr.Pty"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty"}
                                                ]},
                                                { "or": [
                                                    {"var": "Dbtr.Pty.Id.OrgId.AnyBIC"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty.Id.OrgId.AnyBIC"}
                                                ]}
                                            ]},
                                            {
                                                "identification_code": { "if": [
                                                    {"var": "Dbtr.Pty.Id.OrgId.AnyBIC"},
                                                    {"var": "Dbtr.Pty.Id.OrgId.AnyBIC"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty.Id.OrgId.AnyBIC"}
                                                ]}
                                            },
                                            null
                                        ]},
                                        "50F": { "if": [
                                            { "and": [
                                                { "or": [
                                                    {"var": "Dbtr.Pty"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty"}
                                                ]},
                                                {
                                                    "not": { "or": [
                                                        {"var": "Dbtr.Pty.Id.OrgId.AnyBIC"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty.Id.OrgId.AnyBIC"}
                                                    ]}
                                                },
                                                { "or": [
                                                    {"var": "Dbtr.Pty.PstlAdr.Ctry"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty.PstlAdr.Ctry"}
                                                ]}
                                            ]},
                                            {
                                                "party_identifier": { "if": [
                                                    { "or": [
                                                        {"var": "Dbtr.Pty.Id.OrgId.Othr.Id"},
                                                        {"var": "Dbtr.Pty.Id.PrvtId.Othr.Id"}
                                                    ]},
                                                    { "if": [
                                                        {"var": "Dbtr.Pty.Id.OrgId.Othr.Id"},
                                                        {"var": "Dbtr.Pty.Id.OrgId.Othr.Id"},
                                                        {"var": "Dbtr.Pty.Id.PrvtId.Othr.Id"}
                                                    ]},
                                                    "/NOTPROVIDED"
                                                ]},
                                                "number_and_name_and_address": [
                                                    { "if": [
                                                        {"var": "Dbtr.Pty.Nm"},
                                                        {"var": "Dbtr.Pty.Nm"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty.Nm"}
                                                    ]},
                                                    { "if": [
                                                        {"var": "Dbtr.Pty.PstlAdr.StrtNm"},
                                                        {"var": "Dbtr.Pty.PstlAdr.StrtNm"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty.PstlAdr.StrtNm"}
                                                    ]},
                                                    { "if": [
                                                        {"var": "Dbtr.Pty.PstlAdr.TwnNm"},
                                                        {"var": "Dbtr.Pty.PstlAdr.TwnNm"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty.PstlAdr.TwnNm"}
                                                    ]},
                                                    { "if": [
                                                        {"var": "Dbtr.Pty.PstlAdr.Ctry"},
                                                        {"var": "Dbtr.Pty.PstlAdr.Ctry"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Pty.PstlAdr.Ctry"}
                                                    ]}
                                                ]
                                            },
                                            null
                                        ]},
                                        "52A": { "if": [
                                            { "and": [
                                                { "or": [
                                                    {"var": "Dbtr.Agt"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Agt"}
                                                ]},
                                                { "or": [
                                                    {"var": "Dbtr.Agt.FinInstnId.BICFI"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Agt.FinInstnId.BICFI"}
                                                ]}
                                            ]},
                                            {
                                                "party_identifier": null,
                                                "identification_code": { "if": [
                                                    {"var": "Dbtr.Agt.FinInstnId.BICFI"},
                                                    {"var": "Dbtr.Agt.FinInstnId.BICFI"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Agt.FinInstnId.BICFI"}
                                                ]}
                                            },
                                            null
                                        ]},
                                        "52D": { "if": [
                                            { "and": [
                                                { "or": [
                                                    {"var": "Dbtr.Agt"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Agt"}
                                                ]},
                                                {
                                                    "not": { "or": [
                                                        {"var": "Dbtr.Agt.FinInstnId.BICFI"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Agt.FinInstnId.BICFI"}
                                                    ]}
                                                },
                                                { "or": [
                                                    {"var": "Dbtr.Agt.FinInstnId.Nm"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Agt.FinInstnId.Nm"}
                                                ]}
                                            ]},
                                            {
                                                "party_identifier": { "if": [
                                                    {"var": "Dbtr.Agt.FinInstnId.ClrSysMmbId.MmbId"},
                                                    {
                                                        "cat": [
                                                            "/",
                                                            {"var": "Dbtr.Agt.FinInstnId.ClrSysMmbId.ClrSysId.Cd"},
                                                            "/",
                                                            {"var": "Dbtr.Agt.FinInstnId.ClrSysMmbId.MmbId"}
                                                        ]
                                                    },
                                                    null
                                                ]},
                                                "name_and_address": [
                                                    { "if": [
                                                        {"var": "Dbtr.Agt.FinInstnId.Nm"},
                                                        {"var": "Dbtr.Agt.FinInstnId.Nm"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Agt.FinInstnId.Nm"}
                                                    ]},
                                                    { "if": [
                                                        {"var": "Dbtr.Agt.FinInstnId.PstlAdr.AdrLine.0"},
                                                        {"var": "Dbtr.Agt.FinInstnId.PstlAdr.AdrLine.0"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Agt.FinInstnId.PstlAdr.AdrLine.0"}
                                                    ]},
                                                    { "if": [
                                                        {"var": "Dbtr.Agt.FinInstnId.PstlAdr.AdrLine.1"},
                                                        {"var": "Dbtr.Agt.FinInstnId.PstlAdr.AdrLine.1"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Agt.FinInstnId.PstlAdr.AdrLine.1"}
                                                    ]},
                                                    { "if": [
                                                        {"var": "Dbtr.Agt.FinInstnId.PstlAdr.AdrLine.2"},
                                                        {"var": "Dbtr.Agt.FinInstnId.PstlAdr.AdrLine.2"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.Dbtr.Agt.FinInstnId.PstlAdr.AdrLine.2"}
                                                    ]}
                                                ]
                                            },
                                            null
                                        ]},
                                        "56A": { "if": [
                                            { "and": [
                                                { "or": [
                                                    {"var": "IntrmyAgt"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.IntrmyAgt"}
                                                ]},
                                                { "or": [
                                                    {"var": "IntrmyAgt.FinInstnId.BICFI"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.IntrmyAgt.FinInstnId.BICFI"}
                                                ]}
                                            ]},
                                            {
                                                "party_identifier": null,
                                                "identification_code": { "if": [
                                                    {"var": "IntrmyAgt.FinInstnId.BICFI"},
                                                    {"var": "IntrmyAgt.FinInstnId.BICFI"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.IntrmyAgt.FinInstnId.BICFI"}
                                                ]}
                                            },
                                            null
                                        ]},
                                        "56D": { "if": [
                                            { "and": [
                                                { "or": [
                                                    {"var": "IntrmyAgt"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.IntrmyAgt"}
                                                ]},
                                                {
                                                    "not": { "or": [
                                                        {"var": "IntrmyAgt.FinInstnId.BICFI"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.IntrmyAgt.FinInstnId.BICFI"}
                                                    ]}
                                                },
                                                { "or": [
                                                    {"var": "IntrmyAgt.FinInstnId.Nm"},
                                                    {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.IntrmyAgt.FinInstnId.Nm"}
                                                ]}
                                            ]},
                                            {
                                                "party_identifier": { "if": [
                                                    {"var": "IntrmyAgt.FinInstnId.ClrSysMmbId.MmbId"},
                                                    {
                                                        "cat": [
                                                            "/",
                                                            {"var": "IntrmyAgt.FinInstnId.ClrSysMmbId.ClrSysId.Cd"},
                                                            "/",
                                                            {"var": "IntrmyAgt.FinInstnId.ClrSysMmbId.MmbId"}
                                                        ]
                                                    },
                                                    null
                                                ]},
                                                "name_and_address": [
                                                    { "if": [
                                                        {"var": "IntrmyAgt.FinInstnId.Nm"},
                                                        {"var": "IntrmyAgt.FinInstnId.Nm"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.IntrmyAgt.FinInstnId.Nm"}
                                                    ]},
                                                    { "if": [
                                                        {"var": "IntrmyAgt.FinInstnId.PstlAdr.AdrLine.0"},
                                                        {"var": "IntrmyAgt.FinInstnId.PstlAdr.AdrLine.0"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.IntrmyAgt.FinInstnId.PstlAdr.AdrLine.0"}
                                                    ]},
                                                    { "if": [
                                                        {"var": "IntrmyAgt.FinInstnId.PstlAdr.AdrLine.1"},
                                                        {"var": "IntrmyAgt.FinInstnId.PstlAdr.AdrLine.1"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.IntrmyAgt.FinInstnId.PstlAdr.AdrLine.1"}
                                                    ]},
                                                    { "if": [
                                                        {"var": "IntrmyAgt.FinInstnId.PstlAdr.AdrLine.2"},
                                                        {"var": "IntrmyAgt.FinInstnId.PstlAdr.AdrLine.2"},
                                                        {"var": "data.ISO20022_MX.Document.NtfctnToRcv.Ntfctn.IntrmyAgt.FinInstnId.PstlAdr.AdrLine.2"}
                                                    ]}
                                                ]
                                            },
                                            null
                                        ]}
                                    }
                                ]
                            }
                        }
                    ]
                }
            }
        }
    ]
}
