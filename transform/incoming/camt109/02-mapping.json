{
    "id": "camt109-to-mt112-mapping",
    "name": "camt.109 to MT112 Complete Mapping",
    "description": "Maps camt.109 to MT112 with proper message structure",
    "priority": 3,
    "condition": { "and": [
        {"==": [{"var": "metadata.ISO20022_MX.message_type"}, "camt.109"]},
        {"==": [{"var": "metadata.direction"}, "incoming"]},
        {"==": [{"var": "metadata.progress.workflow_id"}, "camt109-headers-mapping"]},
        {"==": [{"var": "metadata.progress.task_id"}, "map_headers"]},
        {"==": [{"var": "metadata.progress.status_code"}, 200]}
    ]},
    "tasks": [
        {
            "id": "map_mt112_structure",
            "name": "Map Complete MT112 Structure",
            "description": "Map all MT112 fields with proper structure",
            "function": {
                "name": "map",
                "input": {
                    "mappings": [
                        {
                            "path": "data.SwiftMT.fields.#20",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.GrpHdr.MsgId"},
                                {
                                    "reference": {
                                        "substr": [
                                            {"replace": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.GrpHdr.MsgId"}, "-", ""]},
                                            0,
                                            16
                                        ]
                                    }
                                },
                                {"reference": "NOTPROVIDED"}
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.#21",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqNb"},
                                {
                                    "reference": {
                                        "substr": [
                                            {"replace": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqNb"}, "-", ""]},
                                            0,
                                            16
                                        ]
                                    }
                                },
                                {"reference": "NOTPROVIDED"}
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.#30",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.IsseDt"},
                                {"execution_date": {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.IsseDt"}},
                                {"execution_date": "2000-01-01"}
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.32A",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.EffctvDt.Dt"},
                                {
                                    "value_date": {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.EffctvDt.Dt"},
                                    "currency": {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Amt.@Ccy"},
                                    "amount": {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Amt.$value"}
                                },
                                null
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.32B",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.EffctvDt.Dt"},
                                null,
                                {
                                    "currency": {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Amt.@Ccy"},
                                    "amount": {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Amt.$value"}
                                }
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.52A",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.DrwrAgt"},
                                { "if": [
                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.DrwrAgt.FinInstnId.BICFI"},
                                    {"bic": {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.DrwrAgt.FinInstnId.BICFI"}},
                                    null
                                ]},
                                null
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.52D",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.DrwrAgt"},
                                { "if": [
                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.DrwrAgt.FinInstnId.BICFI"},
                                    null,
                                    {
                                        "name_and_address": {
                                            "filter": [
                                                [
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.DrwrAgt.FinInstnId.Nm"},
                                                    { "if": [
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.DrwrAgt.PstlAdr.AdrLine.0"},
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.DrwrAgt.PstlAdr.AdrLine.0"},
                                                        null
                                                    ]}
                                                ],
                                                {"!!": {"var": ""}}
                                            ]
                                        }
                                    }
                                ]},
                                null
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.#59",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Pyee"},
                                {
                                    "name_and_address": {
                                        "filter": [
                                            [
                                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Pyee.Nm"},
                                                { "if": [
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Pyee.PstlAdr.StrtNm"},
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Pyee.PstlAdr.StrtNm"},
                                                    { "if": [
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Pyee.PstlAdr.AdrLine.0"},
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Pyee.PstlAdr.AdrLine.0"},
                                                        null
                                                    ]}
                                                ]},
                                                { "if": [
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Pyee.PstlAdr.TwnNm"},
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Pyee.PstlAdr.TwnNm"},
                                                    { "if": [
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Pyee.PstlAdr.AdrLine.1"},
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Pyee.PstlAdr.AdrLine.1"},
                                                        null
                                                    ]}
                                                ]},
                                                { "if": [
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Pyee.PstlAdr.Ctry"},
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Pyee.PstlAdr.Ctry"},
                                                    { "if": [
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Pyee.PstlAdr.AdrLine.2"},
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.Pyee.PstlAdr.AdrLine.2"},
                                                        null
                                                    ]}
                                                ]}
                                            ],
                                            {"!!": {"var": ""}}
                                        ]
                                    }
                                },
                                null
                            ]}
                        },
                        {
                            "path": "data.SwiftMT.fields.#76",
                            "logic": { "if": [
                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts"},
                                {
                                    "information": {
                                        "filter": [
                                            [
                                                { "if": [
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Cd"},
                                                    { "if": [
                                                        {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Cd"}, "ACCR"]},
                                                        "ACCEPTED WITH CHANGE",
                                                        { "if": [
                                                            {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Cd"}, "ACCP"]},
                                                            "ACCEPTED",
                                                            { "if": [
                                                                {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Cd"}, "ACSC"]},
                                                                "ACCEPTED SETTLEMENT COMPLETED",
                                                                { "if": [
                                                                    {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Cd"}, "ACSP"]},
                                                                    "ACCEPTED SETTLEMENT IN PROCESS",
                                                                    { "if": [
                                                                        {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Cd"}, "ACTC"]},
                                                                        "ACCEPTED TECHNICAL VALIDATION",
                                                                        { "if": [
                                                                            {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Cd"}, "CANC"]},
                                                                            "CANCELLED",
                                                                            { "if": [
                                                                                {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Cd"}, "PART"]},
                                                                                "PARTIALLY ACCEPTED",
                                                                                { "if": [
                                                                                    {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Cd"}, "PDNG"]},
                                                                                    "PENDING",
                                                                                    { "if": [
                                                                                        {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Cd"}, "RCVD"]},
                                                                                        "RECEIVED",
                                                                                        { "if": [
                                                                                            {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Cd"}, "RJCT"]},
                                                                                            "REJECTED",
                                                                                            { "if": [
                                                                                                {"==": [{"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Cd"}, "STOP"]},
                                                                                                "STOPPED",
                                                                                                {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Cd"}
                                                                                            ]}
                                                                                        ]}
                                                                                    ]}
                                                                                ]}
                                                                            ]}
                                                                        ]}
                                                                    ]}
                                                                ]}
                                                            ]}
                                                        ]}
                                                    ]},
                                                    { "if": [
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Prtry"},
                                                        {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.Sts.Prtry"},
                                                        null
                                                    ]}
                                                ]},
                                                { "if": [
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.AddtlInf"},
                                                    {"var": "data.ISO20022_MX.Document.ChqCxlOrStopRpt.Chq.ChqCxlOrStopSts.AddtlInf"},
                                                    null
                                                ]}
                                            ],
                                            {"!!": {"var": ""}}
                                        ]
                                    }
                                },
                                null
                            ]}
                        }
                    ]
                }
            }
        }
    ]
}
