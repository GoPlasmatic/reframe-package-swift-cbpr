{
    "id": "camt054-to-mt202-preconditions",
    "name": "camt.054 to MT202 Advice Preconditions Validation",
    "description": "Validates preconditions for camt.054 to MT202 Advice transformation",
    "priority": 3,
    "condition": { "and": [
        {"==": [{"var": "metadata.SwiftMT.variant"}, "MT202_ADVICE"]},
        {"==": [{"var": "metadata.ISO20022_MX.message_type"}, "camt.054"]},
        {"==": [{"var": "metadata.transformation_direction"}, "mx-to-mt"]},
        {"==": [{"var": "metadata.progress.workflow_id"}, "camt054-variant-detection"]},
        {"==": [{"var": "metadata.progress.task_id"}, "determine_target_message"]},
        {"==": [{"var": "metadata.progress.status_code"}, 200]}
    ]},
    "tasks": [
        {
            "id": "validate_credit_indicator",
            "name": "Validate Credit Indicator (PREC003)",
            "description": "Check credit/debit indicator is not DBIT",
            "function": {
                "name": "validate",
                "input": {
                    "rules": [
                        {
                            "path": "data.ISO20022_MX.Document.BkToCstmrDbtCdtNtfctn.Ntfctn.0.Ntry.0.NtryDtls.0.TxDtls.0.CdtDbtInd",
                            "logic": {"!=": [{"var": "data.ISO20022_MX.Document.BkToCstmrDbtCdtNtfctn.Ntfctn.0.Ntry.0.NtryDtls.0.TxDtls.0.CdtDbtInd"}, "DBIT"]},
                            "message": "PREC003: CreditDebitIndicator must not be DBIT"
                        }
                    ]
                }
            }
        },
        {
            "id": "validate_settlement_date",
            "name": "Validate Settlement Date (PREC004)",
            "description": "Check interbank settlement date present",
            "function": {
                "name": "validate",
                "input": {
                    "rules": [
                        {
                            "path": "data.ISO20022_MX.Document.BkToCstmrDbtCdtNtfctn.Ntfctn.0.Ntry.0.NtryDtls.0.TxDtls.0.RltdDts.IntrBkSttlmDt",
                            "logic": {"!!": {"var": "data.ISO20022_MX.Document.BkToCstmrDbtCdtNtfctn.Ntfctn.0.Ntry.0.NtryDtls.0.TxDtls.0.RltdDts.IntrBkSttlmDt"}},
                            "message": "PREC004: InterbankSettlementDate must be present"
                        }
                    ]
                }
            }
        },
        {
            "id": "validate_uetr",
            "name": "Validate UETR (PREC005)",
            "description": "Check UETR present",
            "function": {
                "name": "validate",
                "input": {
                    "rules": [
                        {
                            "path": "data.ISO20022_MX.Document.BkToCstmrDbtCdtNtfctn.Ntfctn.0.Ntry.0.NtryDtls.0.TxDtls.0.Refs.UETR",
                            "logic": {"!!": {"var": "data.ISO20022_MX.Document.BkToCstmrDbtCdtNtfctn.Ntfctn.0.Ntry.0.NtryDtls.0.TxDtls.0.Refs.UETR"}},
                            "message": "PREC005: UETR must be present"
                        }
                    ]
                }
            }
        },
        {
            "id": "validate_amount",
            "name": "Validate Amount (PREC006)",
            "description": "Check amount present",
            "function": {
                "name": "validate",
                "input": {
                    "rules": [
                        {
                            "path": "data.ISO20022_MX.Document.BkToCstmrDbtCdtNtfctn.Ntfctn.0.Ntry.0.NtryDtls.0.TxDtls.0.Amt",
                            "logic": {"!!": {"var": "data.ISO20022_MX.Document.BkToCstmrDbtCdtNtfctn.Ntfctn.0.Ntry.0.NtryDtls.0.TxDtls.0.Amt.$value"}},
                            "message": "PREC006: Amount must be present"
                        }
                    ]
                }
            }
        },
        {
            "id": "validate_creditor_agent",
            "name": "Validate Creditor Agent (PREC007)",
            "description": "Check creditor agent present",
            "function": {
                "name": "validate",
                "input": {
                    "rules": [
                        {
                            "path": "data.ISO20022_MX.Document.BkToCstmrDbtCdtNtfctn.Ntfctn.0.Ntry.0.NtryDtls.0.TxDtls.0.RltdPties.Cdtr.Agt",
                            "logic": {"!!": {"var": "data.ISO20022_MX.Document.BkToCstmrDbtCdtNtfctn.Ntfctn.0.Ntry.0.NtryDtls.0.TxDtls.0.RltdPties.Cdtr.Agt"}},
                            "message": "PREC007: CreditorAgent must be present"
                        }
                    ]
                }
            }
        },
        {
            "id": "validate_debtor_agent",
            "name": "Validate Debtor Agent (PREC008)",
            "description": "Check debtor agent present",
            "function": {
                "name": "validate",
                "input": {
                    "rules": [
                        {
                            "path": "data.ISO20022_MX.Document.BkToCstmrDbtCdtNtfctn.Ntfctn.0.Ntry.0.NtryDtls.0.TxDtls.0.RltdPties.Dbtr.Agt",
                            "logic": {"!!": {"var": "data.ISO20022_MX.Document.BkToCstmrDbtCdtNtfctn.Ntfctn.0.Ntry.0.NtryDtls.0.TxDtls.0.RltdPties.Dbtr.Agt"}},
                            "message": "PREC008: DebtorAgent must be present"
                        }
                    ]
                }
            }
        }
    ]
}
